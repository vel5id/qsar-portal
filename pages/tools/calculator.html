<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ - QSAR Portal</title>
    <meta name="description" content="–†–∞—Å—á—ë—Ç –º–æ–ª–µ–∫—É–ª—è—Ä–Ω—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ —Å –ø–æ–º–æ—â—å—é Python (Pyodide) –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">
    <!-- Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        @media (max-width: 900px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
        }

        .input-panel,
        .output-panel {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .descriptor-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .descriptor-table th,
        .descriptor-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .descriptor-table th {
            background: var(--accent-primary);
            color: white;
        }

        .descriptor-value {
            font-family: 'Fira Code', monospace;
            font-weight: 600;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-loading {
            background: #ffc107;
            color: #333;
        }

        .status-ready {
            background: #28a745;
            color: white;
        }

        .status-error {
            background: #dc3545;
            color: white;
        }

        .batch-input {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Fira Code', monospace;
            resize: vertical;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .python-badge {
            background: linear-gradient(135deg, #3776ab, #ffd43b);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .python-badge i {
            color: #ffd43b;
        }

        /* Pyodide Loader Overlay */
        .pyodide-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .pyodide-loader.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader-content {
            text-align: center;
            color: white;
        }

        .loader-icon {
            font-size: 4em;
            margin-bottom: 30px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .loader-icon i {
            background: linear-gradient(135deg, #3776ab, #ffd43b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .loader-progress {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .loader-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3776ab, #ffd43b);
            width: 0%;
            animation: loadProgress 12s ease-out forwards;
        }

        .loader-fact {
            font-size: 0.95em;
            color: rgba(255, 255, 255, 0.7);
            max-width: 400px;
            margin-top: 20px;
            line-height: 1.6;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        @keyframes loadProgress {
            0% {
                width: 0%;
            }

            20% {
                width: 30%;
            }

            50% {
                width: 60%;
            }

            80% {
                width: 85%;
            }

            100% {
                width: 95%;
            }
        }
    </style>
</head>

<body>

    <!-- Pyodide Loader Overlay -->
    <div id="pyodideLoader" class="pyodide-loader">
        <div class="loader-content">
            <div class="loader-icon"><i class="fab fa-python"></i></div>
            <h2>–ó–∞–≥—Ä—É–∑–∫–∞ Python...</h2>
            <div class="loader-progress">
                <div class="loader-progress-bar"></div>
            </div>
            <p id="loaderStatus">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Pyodide (~10 –ú–ë)</p>
            <p id="loaderFact" class="loader-fact">üí° QSAR —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ Quantitative Structure-Activity
                Relationship</p>
        </div>
    </div>

    <header class="site-header">
        <div class="container">
            <div class="logo">QSAR Portal üß¨</div>
            <button class="theme-toggle" aria-label="–¢–µ–º–∞"><i class="fas fa-moon"></i></button>
            <button class="menu-toggle" aria-label="–ú–µ–Ω—é"><i class="fas fa-bars"></i></button>
            <nav class="main-nav">
                <ul>
                    <li><a href="../../index.html"><i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="../../pages/basics/index.html"><i class="fas fa-book"></i> –û—Å–Ω–æ–≤—ã QSAR</a></li>
                    <li><a href="hub.html" class="active"><i class="fas fa-laptop-code"></i> –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a></li>
                    <li><a href="../../pages/practice/smiles.html"><i class="fas fa-flask"></i> –ü—Ä–∞–∫—Ç–∏–∫–∞</a></li>
                    <li><a href="../../pages/literature/index.html"><i class="fas fa-graduation-cap"></i> –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</a>
                    </li>
                    <li><a href="../../pages/contacts.html"><i class="fas fa-envelope"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Breadcrumb -->
    <nav class="breadcrumb"
        style="background: var(--bg-secondary); padding: 10px 0; border-bottom: 1px solid var(--border-color);">
        <div class="container">
            <a href="../../index.html">–ì–ª–∞–≤–Ω–∞—è</a> /
            <a href="hub.html">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a> /
            <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤</span>
        </div>
    </nav>

    <main>
        <section class="content-section">
            <div class="container">
                <div
                    style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <h1><i class="fas fa-calculator"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–æ–ª–µ–∫—É–ª—è—Ä–Ω—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤</h1>
                    <span class="python-badge"><i class="fab fa-python"></i> Powered by Python (Pyodide)</span>
                </div>

                <p style="margin-top: 10px; color: var(--text-secondary);">
                    –†–∞—Å—á—ë—Ç –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ —Å –ø–æ–º–æ—â—å—é Python.
                </p>

                <!-- Status -->
                <div style="margin: 20px 0;">
                    <strong>–°—Ç–∞—Ç—É—Å Python:</strong>
                    <span id="pyStatus" class="status-badge status-loading">
                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ Pyodide...
                    </span>
                </div>

                <div class="calculator-grid">
                    <!-- Input Panel -->
                    <div class="input-panel">
                        <h3><i class="fas fa-edit"></i> –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö</h3>

                        <!-- Mode Switch -->
                        <div style="margin: 20px 0; display: flex; gap: 10px;">
                            <button id="singleMode" class="btn" style="flex: 1;">
                                <i class="fas fa-atom"></i> –û–¥–Ω–∞ –º–æ–ª–µ–∫—É–ª–∞
                            </button>
                            <button id="batchMode" class="btn" style="flex: 1; background: #6c757d;">
                                <i class="fas fa-list"></i> –ë–∞—Ç—á (–Ω–µ—Å–∫–æ–ª—å–∫–æ)
                            </button>
                        </div>

                        <!-- Single Input -->
                        <div id="singleInput">
                            <label style="display: block; margin-bottom: 10px; font-weight: 600;">SMILES:</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="smilesInput" placeholder="CC(=O)OC1=CC=CC=C1C(=O)O"
                                    style="flex: 1; padding: 12px; border: 2px solid var(--border-color); border-radius: 8px; font-family: monospace; background: var(--bg-primary); color: var(--text-primary);">
                            </div>

                            <div style="margin-top: 15px;">
                                <p style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 10px;">–ü—Ä–∏–º–µ—Ä—ã:
                                </p>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                    <button class="sample-btn" data-smiles="CC(=O)OC1=CC=CC=C1C(=O)O">–ê—Å–ø–∏—Ä–∏–Ω</button>
                                    <button class="sample-btn"
                                        data-smiles="CN1C=NC2=C1C(=O)N(C(=O)N2C)C">–ö–æ—Ñ–µ–∏–Ω</button>
                                    <button class="sample-btn"
                                        data-smiles="CC(C)CC1=CC=C(C=C1)C(C)C(=O)O">–ò–±—É–ø—Ä–æ—Ñ–µ–Ω</button>
                                    <button class="sample-btn" data-smiles="c1ccccc1">–ë–µ–Ω–∑–æ–ª</button>
                                </div>
                            </div>
                        </div>

                        <!-- Batch Input -->
                        <div id="batchInput" style="display: none;">
                            <label style="display: block; margin-bottom: 10px; font-weight: 600;">
                                –°–ø–∏—Å–æ–∫ SMILES (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É):
                            </label>
                            <textarea id="batchSmiles" class="batch-input" placeholder="CC(=O)OC1=CC=CC=C1C(=O)O
CN1C=NC2=C1C(=O)N(C(=O)N2C)C
CC(C)CC1=CC=C(C=C1)C(C)C(=O)O"></textarea>
                        </div>

                        <button id="calculateBtn" class="btn" style="width: 100%; margin-top: 20px; padding: 15px;"
                            disabled>
                            <i class="fas fa-cogs"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã
                        </button>
                    </div>

                    <!-- Output Panel -->
                    <div class="output-panel">
                        <h3><i class="fas fa-chart-bar"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>

                        <div id="resultsArea" style="margin-top: 15px;">
                            <p style="color: var(--text-secondary); text-align: center; padding: 40px 0;">
                                <i class="fas fa-flask"
                                    style="font-size: 3em; display: block; margin-bottom: 15px; opacity: 0.3;"></i>
                                –í–≤–µ–¥–∏—Ç–µ SMILES –∏ –Ω–∞–∂–º–∏—Ç–µ "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å"
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Info Block -->
                <div
                    style="margin-top: 40px; padding: 25px; background: linear-gradient(135deg, rgba(55, 118, 171, 0.1), rgba(255, 212, 59, 0.1)); border-radius: 12px; border-left: 4px solid #3776ab;">
                    <h3><i class="fab fa-python"></i> –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
                    <ul style="margin-top: 15px; line-height: 1.8;">
                        <li><strong>Pyodide</strong> ‚Äî —ç—Ç–æ –ø–æ—Ä—Ç CPython –¥–ª—è WebAssembly</li>
                        <li>Python –∫–æ–¥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è <strong>–ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</strong></li>
                        <li>–î–∞–Ω–Ω—ã–µ <strong>–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä</strong></li>
                        <li>–ü–µ—Ä–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç ~10 —Å–µ–∫—É–Ω–¥ (—Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è ~10 –ú–ë)</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>¬© 2025 –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç. –ö–∞—Ñ–µ–¥—Ä–∞ —Ö–∏–º–∏–∏/–±–∏–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏.</p>
        </div>
    </footer>

    <script src="../../script.js"></script>
    <script>
        // Pyodide Calculator Logic
        let pyodide = null;
        const pyStatus = document.getElementById('pyStatus');
        const calculateBtn = document.getElementById('calculateBtn');
        const smilesInput = document.getElementById('smilesInput');
        const batchSmiles = document.getElementById('batchSmiles');
        const resultsArea = document.getElementById('resultsArea');
        const singleMode = document.getElementById('singleMode');
        const batchMode = document.getElementById('batchMode');
        const singleInput = document.getElementById('singleInput');
        const batchInput = document.getElementById('batchInput');

        let isBatchMode = false;

        // Mode switching
        singleMode.addEventListener('click', () => {
            isBatchMode = false;
            singleMode.style.background = '';
            batchMode.style.background = '#6c757d';
            singleInput.style.display = 'block';
            batchInput.style.display = 'none';
        });

        batchMode.addEventListener('click', () => {
            isBatchMode = true;
            batchMode.style.background = '';
            singleMode.style.background = '#6c757d';
            singleInput.style.display = 'none';
            batchInput.style.display = 'block';
        });

        // Sample buttons
        document.querySelectorAll('.sample-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                smilesInput.value = btn.dataset.smiles;
            });
        });

        // Initialize Pyodide
        async function initPyodide() {
            try {
                pyodide = await loadPyodide();

                // Load Python code for molecular calculations
                await pyodide.runPythonAsync(`
import re
from collections import Counter

def parse_smiles(smiles):
    """Parse SMILES and extract basic information."""
    # Remove stereochemistry markers for simplicity
    clean = re.sub(r'[@/\\\\]', '', smiles)
    
    # Count atoms
    atoms = re.findall(r'[A-Z][a-z]?', smiles)
    atom_counts = Counter(atoms)
    
    # Estimate hydrogen count (simplified)
    h_count = 0
    for atom, count in atom_counts.items():
        if atom == 'C':
            h_count += count * 2  # Rough estimate
        elif atom in ['N', 'O']:
            h_count += count
    
    return atoms, atom_counts, h_count

def calculate_mw(smiles):
    """Calculate molecular weight."""
    weights = {'C': 12.011, 'H': 1.008, 'N': 14.007, 'O': 15.999, 
               'S': 32.065, 'P': 30.974, 'F': 18.998, 'Cl': 35.453, 
               'Br': 79.904, 'I': 126.904}
    
    atoms, atom_counts, h_count = parse_smiles(smiles)
    
    mw = 0
    for atom, count in atom_counts.items():
        mw += weights.get(atom, 12) * count
    mw += h_count * 1.008
    
    return round(mw, 2)

def calculate_logp(smiles):
    """Estimate LogP using fragment method."""
    logp = 0
    atoms, atom_counts, _ = parse_smiles(smiles)
    
    # Simplified Wildman-Crippen
    logp += atom_counts.get('C', 0) * 0.25
    logp -= atom_counts.get('O', 0) * 0.5
    logp -= atom_counts.get('N', 0) * 0.5
    logp += atom_counts.get('Cl', 0) * 0.6
    logp += atom_counts.get('Br', 0) * 0.8
    logp += atom_counts.get('F', 0) * 0.3
    logp += atom_counts.get('S', 0) * 0.2
    
    # Ring penalty
    rings = smiles.count('1') + smiles.count('2') + smiles.count('3')
    logp += rings * 0.1
    
    return round(max(-3, min(7, logp)), 2)

def calculate_hbd(smiles):
    """Count H-bond donors (OH, NH)."""
    count = len(re.findall(r'O(?=[^=]|$)', smiles))
    count += len(re.findall(r'N(?![=#])', smiles))
    return max(0, count)

def calculate_hba(smiles):
    """Count H-bond acceptors (O, N)."""
    count = smiles.count('O') + smiles.count('N')
    return count

def calculate_tpsa(smiles):
    """Estimate TPSA (topological polar surface area)."""
    # Simplified: O contributes ~20, N contributes ~26
    tpsa = smiles.count('O') * 20.23 + smiles.count('N') * 26.02
    return round(tpsa, 2)

def calculate_rotatable_bonds(smiles):
    """Estimate rotatable bonds."""
    # Simple heuristic based on single bonds
    single_bonds = smiles.count('-') + len(re.findall(r'[A-Z][a-z]?[A-Z]', smiles))
    return max(0, single_bonds)

def calculate_rings(smiles):
    """Count rings."""
    return len(re.findall(r'[0-9]', smiles)) // 2

def calculate_descriptors(smiles):
    """Calculate all descriptors for a SMILES."""
    return {
        'MW': calculate_mw(smiles),
        'LogP': calculate_logp(smiles),
        'HBD': calculate_hbd(smiles),
        'HBA': calculate_hba(smiles),
        'TPSA': calculate_tpsa(smiles),
        'RotBonds': calculate_rotatable_bonds(smiles),
        'Rings': calculate_rings(smiles)
    }

def lipinski_check(desc):
    """Check Lipinski Rule of 5."""
    rules = [
        desc['MW'] <= 500,
        desc['LogP'] <= 5,
        desc['HBD'] <= 5,
        desc['HBA'] <= 10
    ]
    return sum(rules), 4
                `);

                pyStatus.className = 'status-badge status-ready';
                pyStatus.innerHTML = '<i class="fas fa-check"></i> Python –≥–æ—Ç–æ–≤';
                calculateBtn.disabled = false;

                // Hide loader overlay
                const loader = document.getElementById('pyodideLoader');
                if (loader) {
                    loader.classList.add('hidden');
                    setTimeout(() => loader.remove(), 600);
                }

            } catch (error) {
                console.error('Pyodide error:', error);
                pyStatus.className = 'status-badge status-error';
                pyStatus.innerHTML = '<i class="fas fa-times"></i> –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';

                // Update loader with error
                const loaderStatus = document.getElementById('loaderStatus');
                const loader = document.getElementById('pyodideLoader');
                if (loaderStatus) loaderStatus.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Pyodide';
                if (loader) loader.querySelector('.loader-progress-bar').style.background = '#dc3545';
            }
        }

        // Rotate chemistry facts during loading
        const facts = [
            'üí° –ü—Ä–∞–≤–∏–ª–æ –õ–∏–ø–∏–Ω—Å–∫–∏ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å –±–∏–æ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–ª–µ–∫—É–ª—ã',
            'üß¨ SMILES ‚Äî —ç—Ç–æ —è–∑—ã–∫ –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–ª–µ–∫—É–ª',
            '‚öóÔ∏è LogP –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å—Ç–≤–æ—Ä–∏–º–æ—Å—Ç—å –≤ –∂–∏—Ä–∞—Ö vs –≤–æ–¥–µ',
            'üî¨ Pyodide –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å Python –≤ –±—Ä–∞—É–∑–µ—Ä–µ',
            'üìä –î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã ‚Äî —á–∏—Å–ª–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ–ª–µ–∫—É–ª',
            'üíä Drug-likeness –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –ø–æ 4+ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º'
        ];
        let factIndex = 0;
        const factInterval = setInterval(() => {
            const factEl = document.getElementById('loaderFact');
            if (factEl) {
                factIndex = (factIndex + 1) % facts.length;
                factEl.textContent = facts[factIndex];
            } else {
                clearInterval(factInterval);
            }
        }, 3000);

        // Calculate descriptors
        calculateBtn.addEventListener('click', async () => {
            if (!pyodide) return;

            const smilesList = isBatchMode
                ? batchSmiles.value.split('\n').filter(s => s.trim())
                : [smilesInput.value.trim()];

            if (smilesList.length === 0 || smilesList[0] === '') {
                resultsArea.innerHTML = '<p style="color: #dc3545;">–í–≤–µ–¥–∏—Ç–µ SMILES!</p>';
                return;
            }

            resultsArea.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> –†–∞—Å—á—ë—Ç...</p>';

            try {
                let html = '';

                for (let i = 0; i < smilesList.length; i++) {
                    const smiles = smilesList[i].trim();
                    if (!smiles) continue;

                    const result = await pyodide.runPythonAsync(`
import json
desc = calculate_descriptors("${smiles}")
passed, total = lipinski_check(desc)
json.dumps({'descriptors': desc, 'lipinski_passed': passed, 'lipinski_total': total})
                    `);

                    const data = JSON.parse(result);
                    const desc = data.descriptors;
                    const lipinskiPass = data.lipinski_passed >= 3;

                    html += `
                        <div style="margin-bottom: 25px; padding: 20px; background: var(--bg-primary); border-radius: 12px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <code style="font-size: 0.9em;">${smiles}</code>
                                <span class="status-badge ${lipinskiPass ? 'status-ready' : 'status-error'}">
                                    ${lipinskiPass ? '‚úì Drug-like' : '‚úó Not drug-like'} (${data.lipinski_passed}/${data.lipinski_total})
                                </span>
                            </div>
                            <table class="descriptor-table">
                                <tr><th>–î–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–û–ø–∏—Å–∞–Ω–∏–µ</th></tr>
                                <tr><td>MW</td><td class="descriptor-value">${desc.MW}</td><td>–ú–æ–ª–µ–∫—É–ª—è—Ä–Ω–∞—è –º–∞—Å—Å–∞ (–≥/–º–æ–ª—å)</td></tr>
                                <tr><td>LogP</td><td class="descriptor-value">${desc.LogP}</td><td>–õ–∏–ø–æ—Ñ–∏–ª—å–Ω–æ—Å—Ç—å</td></tr>
                                <tr><td>HBD</td><td class="descriptor-value">${desc.HBD}</td><td>–î–æ–Ω–æ—Ä—ã H-—Å–≤—è–∑–µ–π</td></tr>
                                <tr><td>HBA</td><td class="descriptor-value">${desc.HBA}</td><td>–ê–∫—Ü–µ–ø—Ç–æ—Ä—ã H-—Å–≤—è–∑–µ–π</td></tr>
                                <tr><td>TPSA</td><td class="descriptor-value">${desc.TPSA}</td><td>–ü–æ–ª—è—Ä–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å (√Ö¬≤)</td></tr>
                                <tr><td>RotBonds</td><td class="descriptor-value">${desc.RotBonds}</td><td>–í—Ä–∞—â–∞–µ–º—ã–µ —Å–≤—è–∑–∏</td></tr>
                                <tr><td>Rings</td><td class="descriptor-value">${desc.Rings}</td><td>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–µ—Ü</td></tr>
                            </table>
                        </div>
                    `;
                }

                resultsArea.innerHTML = html;

                if (typeof showToast === 'function') {
                    showToast(`–†–∞—Å—Å—á–∏—Ç–∞–Ω–æ ${smilesList.length} –º–æ–ª–µ–∫—É–ª(–∞)`);
                }

            } catch (error) {
                console.error('Calculation error:', error);
                resultsArea.innerHTML = `<p style="color: #dc3545;"><i class="fas fa-exclamation-triangle"></i> –û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        });

        // Initialize on load
        initPyodide();
    </script>
</body>

</html>
