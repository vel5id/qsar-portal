<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∏—Å–∫ –ø–æ PubChem - QSAR Portal</title>
    <meta name="description" content="–ü–æ–∏—Å–∫ —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ –±–∞–∑–µ PubChem –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, SMILES –∏–ª–∏ CID.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="../../assets/images/favicon.png">
    <style>
        .search-box {
            display: flex;
            gap: 15px;
            margin: 30px 0;
        }

        .search-box input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1.1em;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .search-box input:focus {
            border-color: #667eea;
            outline: none;
        }

        .search-type {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-type button {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .search-type button.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .compound-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 6px var(--shadow);
            transition: transform 0.3s ease;
        }

        .compound-card:hover {
            transform: translateY(-5px);
        }

        .compound-image {
            width: 100%;
            height: 200px;
            object-fit: contain;
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .compound-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .compound-props {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9em;
        }

        .prop-item {
            padding: 8px;
            background: var(--bg-primary);
            border-radius: 6px;
        }

        .prop-label {
            color: var(--text-secondary);
            font-size: 0.85em;
        }

        .prop-value {
            font-weight: 600;
            font-family: 'Fira Code', monospace;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: var(--text-secondary);
        }

        .loading i {
            font-size: 3em;
            margin-bottom: 20px;
            color: #667eea;
        }

        @media (max-width: 600px) {
            .search-box {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>

    <header class="site-header">
        <div class="container">
            <div class="logo">QSAR Portal üß¨</div>
            <button class="theme-toggle" aria-label="–¢–µ–º–∞"><i class="fas fa-moon"></i></button>
            <button class="menu-toggle" aria-label="–ú–µ–Ω—é"><i class="fas fa-bars"></i></button>
            <nav class="main-nav">
                <ul>
                    <li><a href="../../index.html"><i class="fas fa-home"></i> –ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="../../pages/basics/index.html"><i class="fas fa-book"></i> –û—Å–Ω–æ–≤—ã QSAR</a></li>
                    <li><a href="hub.html" class="active"><i class="fas fa-laptop-code"></i> –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a></li>
                    <li><a href="../../pages/practice/smiles.html"><i class="fas fa-flask"></i> –ü—Ä–∞–∫—Ç–∏–∫–∞</a></li>
                    <li><a href="../../pages/literature/index.html"><i class="fas fa-graduation-cap"></i> –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</a>
                    </li>
                    <li><a href="../../pages/contacts.html"><i class="fas fa-envelope"></i> –ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Breadcrumb -->
    <nav class="breadcrumb"
        style="background: var(--bg-secondary); padding: 10px 0; border-bottom: 1px solid var(--border-color);">
        <div class="container">
            <a href="../../index.html">–ì–ª–∞–≤–Ω–∞—è</a> /
            <a href="hub.html">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</a> /
            <span>–ü–æ–∏—Å–∫ PubChem</span>
        </div>
    </nav>

    <main>
        <section class="content-section">
            <div class="container">
                <h1><i class="fas fa-search"></i> –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ PubChem</h1>
                <p style="margin-top: 10px; color: var(--text-secondary);">
                    –ü–æ–∏—Å–∫ –∏–∑ 115+ –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Ö–∏–º–∏—á–µ—Å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ PubChem API.
                </p>

                <!-- Search Type -->
                <div class="search-type">
                    <button id="typeSmiles" class="active">SMILES</button>
                    <button id="typeName">–ù–∞–∑–≤–∞–Ω–∏–µ</button>
                    <button id="typeCid">CID</button>
                </div>

                <!-- Search Box -->
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ SMILES, –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ CID...">
                    <button id="searchBtn" class="btn" style="padding: 15px 30px;">
                        <i class="fas fa-search"></i> –ò—Å–∫–∞—Ç—å
                    </button>
                </div>

                <!-- Quick Examples -->
                <div style="margin-bottom: 20px;">
                    <span style="color: var(--text-secondary); margin-right: 10px;">–ü—Ä–∏–º–µ—Ä—ã:</span>
                    <button class="sample-btn" data-value="aspirin" data-type="name">Aspirin</button>
                    <button class="sample-btn" data-value="caffeine" data-type="name">Caffeine</button>
                    <button class="sample-btn" data-value="ibuprofen" data-type="name">Ibuprofen</button>
                    <button class="sample-btn" data-value="2244" data-type="cid">CID: 2244</button>
                </div>

                <!-- Results -->
                <div id="resultsArea">
                    <p style="text-align: center; color: var(--text-secondary); padding: 50px;">
                        <i class="fas fa-database"
                            style="font-size: 3em; display: block; margin-bottom: 15px; opacity: 0.3;"></i>
                        –í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ PubChem
                    </p>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>¬© 2025 –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å–∫–∏–π –ø—Ä–æ–µ–∫—Ç. –ö–∞—Ñ–µ–¥—Ä–∞ —Ö–∏–º–∏–∏/–±–∏–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏.</p>
        </div>
    </footer>

    <script src="../../script.js"></script>
    <script>
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const resultsArea = document.getElementById('resultsArea');
        const typeButtons = document.querySelectorAll('.search-type button');

        let searchType = 'smiles';

        // Type switching
        typeButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                typeButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                searchType = btn.id.replace('type', '').toLowerCase();

                const placeholders = {
                    smiles: 'CC(=O)OC1=CC=CC=C1C(=O)O',
                    name: 'aspirin, caffeine, ibuprofen...',
                    cid: '2244, 2519, 3672...'
                };
                searchInput.placeholder = placeholders[searchType];
            });
        });

        // Sample buttons
        document.querySelectorAll('.sample-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                searchInput.value = btn.dataset.value;
                const type = btn.dataset.type;
                typeButtons.forEach(b => {
                    b.classList.remove('active');
                    if (b.id === 'type' + type.charAt(0).toUpperCase() + type.slice(1)) {
                        b.classList.add('active');
                    }
                });
                searchType = type;
                searchBtn.click();
            });
        });

        // Search function
        searchBtn.addEventListener('click', async () => {
            const query = searchInput.value.trim();
            if (!query) return;

            resultsArea.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>–ü–æ–∏—Å–∫ –≤ PubChem...</p>
                </div>
            `;

            try {
                let cids = [];

                // Get CIDs based on search type
                if (searchType === 'cid') {
                    cids = query.split(',').map(c => c.trim());
                } else if (searchType === 'name') {
                    const resp = await fetch(
                        `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/${encodeURIComponent(query)}/cids/JSON`
                    );
                    const data = await resp.json();
                    cids = data.IdentifierList?.CID?.slice(0, 6) || [];
                } else {
                    const resp = await fetch(
                        `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/smiles/${encodeURIComponent(query)}/cids/JSON`
                    );
                    const data = await resp.json();
                    cids = data.IdentifierList?.CID?.slice(0, 6) || [];
                }

                if (cids.length === 0) {
                    resultsArea.innerHTML = `
                        <div style="text-align: center; padding: 50px;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; color: #f39c12; display: block; margin-bottom: 15px;"></i>
                            <p>–°–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>
                        </div>
                    `;
                    return;
                }

                // Fetch properties for each CID
                const propsResp = await fetch(
                    `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/${cids.join(',')}/property/MolecularFormula,MolecularWeight,IUPACName,CanonicalSMILES,XLogP/JSON`
                );
                const propsData = await propsResp.json();
                const compounds = propsData.PropertyTable?.Properties || [];

                // Render results
                let html = '<div class="results-grid">';

                for (const compound of compounds) {
                    const imgUrl = `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/${compound.CID}/PNG?image_size=300x300`;

                    html += `
                        <div class="compound-card">
                            <img src="${imgUrl}" alt="Structure" class="compound-image" loading="lazy">
                            <div class="compound-title">CID: ${compound.CID}</div>
                            <p style="font-size: 0.85em; color: var(--text-secondary); margin-bottom: 15px; word-break: break-word;">
                                ${compound.IUPACName || 'N/A'}
                            </p>
                            <div class="compound-props">
                                <div class="prop-item">
                                    <div class="prop-label">–§–æ—Ä–º—É–ª–∞</div>
                                    <div class="prop-value">${compound.MolecularFormula || 'N/A'}</div>
                                </div>
                                <div class="prop-item">
                                    <div class="prop-label">MW</div>
                                    <div class="prop-value">${typeof compound.MolecularWeight === 'number' ? compound.MolecularWeight.toFixed(2) : (compound.MolecularWeight || 'N/A')}</div>
                                </div>
                                <div class="prop-item">
                                    <div class="prop-label">XLogP</div>
                                    <div class="prop-value">${typeof compound.XLogP === 'number' ? compound.XLogP.toFixed(2) : (compound.XLogP || 'N/A')}</div>
                                </div>
                                <div class="prop-item">
                                    <a href="https://pubchem.ncbi.nlm.nih.gov/compound/${compound.CID}" target="_blank" 
                                       class="btn" style="width: 100%; padding: 8px; font-size: 0.85em;">
                                        <i class="fas fa-external-link-alt"></i> PubChem
                                    </a>
                                </div>
                            </div>
                            <div style="margin-top: 15px; padding: 10px; background: var(--bg-primary); border-radius: 6px;">
                                <div class="prop-label">SMILES</div>
                                <code style="font-size: 0.75em; word-break: break-all;">${compound.CanonicalSMILES || 'N/A'}</code>
                            </div>
                        </div>
                    `;
                }

                html += '</div>';
                resultsArea.innerHTML = html;

                if (typeof showToast === 'function') {
                    showToast(`–ù–∞–π–¥–µ–Ω–æ ${compounds.length} —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π`);
                }

            } catch (error) {
                console.error('Search error:', error);
                resultsArea.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 3em; color: #dc3545; display: block; margin-bottom: 15px;"></i>
                        <p>–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${error.message}</p>
                    </div>
                `;
            }
        });

        // Enter key support
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchBtn.click();
        });
    </script>
</body>

</html>
